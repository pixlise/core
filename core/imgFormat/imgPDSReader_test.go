package imgFormat

import (
	"fmt"
	"image/png"
	"os"

	"github.com/pixlise/core/v4/core/imageedit"
)

func Example_findVICAR() {
	imgFileBytes, err := os.ReadFile("./test-data/ZRF_0922_0748803435_956RAS_N0450000ZCAM08928_1100LMJ02.IMG")
	if err != nil {
		return
	}

	pos, err := findVICAR(imgFileBytes)
	fmt.Printf("%v|%v\n", pos, err)

	// Output:
	// 32960|<nil>
}

func Example_readVICARLabel() {
	imgFileBytes, err := os.ReadFile("./test-data/ZRF_0922_0748803435_956RAS_N0450000ZCAM08928_1100LMJ02.IMG")
	if err != nil {
		return
	}

	lbl, err := readVICARLabel(imgFileBytes, 32960)
	fmt.Printf("%v|%v\n", lbl, err)

	// Output:
	// LBLSIZE=19776           FORMAT='HALF'  TYPE='IMAGE'  BUFSIZ=3296  DIM=3  EOL=0  RECSIZE=3296  ORG='BSQ'  NL=1200  NS=1648  NB=3  N1=1648  N2=1200  N3=3  N4=0  NBB=0  NLB=0  HOST='JAVA'  INTFMT='HIGH'  REALFMT='RIEEE'  BHOST='VAX-VMS'  BINTFMT='LOW'  BREALFMT='VAX'  BLTYPE=''  COMPRESS='NONE'  EOCI1=0  EOCI2=0  PROPERTY='IDENTIFICATION'  ACTIVE_FLIGHT_STRING_ID='A'  COMMAND_SEQUENCE_NUMBER=5  FRAME_ID='RIGHT'  FRAME_TYPE='STEREO'  GEOMETRY_PROJECTION_TYPE='RAW'  IMAGE_ID='2816'  IMAGE_TIME='2023-09-24T05:09:45.504'  IMAGE_TYPE='REGULAR'  IMAGE_ACQUIRE_MODE='IMAGE'  INSTRUMENT_HOST_ID='M20'  INSTRUMENT_HOST_NAME='MARS 2020'  INSTRUMENT_ID='MCZ_RIGHT'  INSTRUMENT_NAME='MAST CAMERA ZOOM RIGHT'  INSTRUMENT_SERIAL_NUMBER=102801  INSTRUMENT_TYPE='IMAGING CAMERA'  INSTRUMENT_VERSION_ID='FM'  LOCAL_MEAN_SOLAR_TIME='Sol-00922M15:59:32.000'  LOCAL_TRUE_SOLAR_TIME='16:24:09'  MISSION_NAME='MARS 2020'  MISSION_PHASE_NAME='PRIMARY_SURFACE_MISSION'  PLANET_DAY_NUMBER=922  LOCAL_TRUE_SOLAR_TIME_SOL=922  PRODUCER_INSTITUTION_NAME='MULTIMISSION INSTRUMENT PROCESSING LAB, JET PROPULSION LAB'  PRODUCT_CREATION_TIME='2023-09-25T04:10:13.000'  PRODUCT_VERSION_ID='V2.0 D-22849'  RELEASE_ID='0001'  REQUEST_ID='0'  ROVER_MOTION_COUNTER=(45,0,156,588,518,74,1864,700,42,46)  ROVER_MOTION_COUNTER_NAME=('SITE','DRIVE','POSE','ARM','SHA','DRILL','RSM','HGA','BITCAR','SEAL')  SEQUENCE_ID='zcam08928'  SEQUENCE_VERSION_ID='0'  SOLAR_LONGITUDE=123.266  SPACECRAFT_CLOCK_CNT_PARTITION=1  SPACECRAFT_CLOCK_START_COUNT='748803450.780'  SPACECRAFT_CLOCK_STOP_COUNT='748803450.806'  START_TIME='2023-09-24T05:09:45.504'  STOP_TIME='2023-09-24T05:09:45.504'  TARGET_NAME='MARS'  TARGET_TYPE='PLANET'  CAMERA_PRODUCT_ID='2816'  TRACKING_ID='2008928005'  SOURCE_PRODUCT_ID='ZR0_0922_0748803435_956ECM_N0450000ZCAM08928_1100LMJ02'  PRODUCT_ID='ZRF_0922_0748803435_956RAS_N0450000ZCAM08928_1100LMJ02'  PROPERTY='TELEMETRY'  APPLICATION_PROCESS_ID=689  APPLICATION_PROCESS_NAME='MczRImage'  EARTH_RECEIVED_START_TIME='2023-09-24T18:11:31.042'  EARTH_RECEIVED_STOP_TIME='2023-09-24T18:11:49.026'  EXPECTED_PACKETS=177  RECEIVED_PACKETS=177  SPICE_FILE_NAME='chronos.m2020_ops210303_v1'  TELEMETRY_PROVIDER_ID='MPCS_M2020_DP'  TELEMETRY_SOURCE_HOST_NAME='m20-sstage-control-1'  TELEMETRY_SOURCE_NAME='MczRImage_0748803435-64228-2.dat'  TELEMETRY_SOURCE_TYPE='DATA PRODUCT'  COMMUNICATION_SESSION_ID='39230'  DOWNLOAD_PRIORITY=78  EXPECTED_TRANSMISSION_PATH='128'  FLIGHT_SOFTWARE_MODE='8'  FLIGHT_SOFTWARE_VERSION_ID='475711935'  PRODUCT_COMPLETION_STATUS='COMPLETE_CHECKSUM_PASS'  PRODUCT_TAG='1'  SEQUENCE_EXECUTION_COUNT=1  TELEMETRY_SOURCE_SIZE=1791287  TELEMETRY_SOURCE_CHECKSUM=38592  TELEMETRY_SOURCE_START_TIME='2023-267T05:09:31.471Z'  TELEMETRY_SOURCE_SCLK_START='748803435.980'  AUTO_DELETE_FLAG='FALSE'  TRANSMISSION_PATH='0'  VIRTUAL_CHANNEL_ID='0'  IMAGE_DATA_SIZE=1977664  BOOT_COUNT=4932  COMMAND_DISPATCH_SCLK='748803435.62717'  DATA_PRODUCT_COMPRESSION_TYPE='Uncompressed'  PROPERTY='PDS_HISTORY'  SOFTWARE_NAME='M2020EDRGEN'  SOFTWARE_VERSION_ID='V7.7 1-26-2023'  PROCESSING_HISTORY_TEXT='CODMAC LEVEL 1 TO LEVEL 2 CONVERSION VIA JPL/MIPL M2020EDRGEN'  PROPERTY='ROVER_COORDINATE_SYSTEM'  SOLUTION_ID='TELEMETRY'  COORDINATE_SYSTEM_NAME='ROVER_NAV_FRAME'  COORDINATE_SYSTEM_INDEX=(45,0,156,588,518,74,1864,700,42,46)  COORDINATE_SYSTEM_INDEX_NAME=('SITE','DRIVE','POSE','ARM','SHA','DRILL','RSM','HGA','BITCAR','SEAL')  ORIGIN_OFFSET_VECTOR=(0.0,0.0,0.0)  ORIGIN_ROTATION_QUATERNION=(0.719881,-0.0012752,0.00237094,-0.694093)  POSITIVE_AZIMUTH_DIRECTION='CLOCKWISE'  POSITIVE_ELEVATION_DIRECTION='UP'  QUATERNION_MEASUREMENT_METHOD='FINE'  REFERENCE_COORD_SYSTEM_NAME='SITE_FRAME'  REFERENCE_COORD_SYSTEM_INDEX=45  ATTITUDE_PROPAGATION_COUNTER=0.0  ATTITUDE_PROPAGATION_DURATION=0.0  PROPERTY='RSM_COORDINATE_SYSTEM'  SOLUTION_ID='TELEMETRY'  COORDINATE_SYSTEM_NAME='RSM_HEAD_FRAME'  COORDINATE_SYSTEM_INDEX=(45,0,156,588,518,74,1864,700,42,46)  COORDINATE_SYSTEM_INDEX_NAME=('SITE','DRIVE','POSE','ARM','SHA','DRILL','RSM','HGA','BITCAR','SEAL')  ORIGIN_OFFSET_VECTOR=(0.805021,0.5594,-1.91903)  ORIGIN_ROTATION_QUATERNION=(0.846242,-0.144295,-0.426519,-0.284844)  POSITIVE_AZIMUTH_DIRECTION='CLOCKWISE'  POSITIVE_ELEVATION_DIRECTION='UP'  REFERENCE_COORD_SYSTEM_NAME='ROVER_NAV_FRAME'  REFERENCE_COORD_SYSTEM_INDEX=(45,0,156,588,518,74,1864,700,42,46)  PROPERTY='TURRET_COORDINATE_SYSTEM'  SOLUTION_ID='TELEMETRY'  COORDINATE_SYSTEM_NAME='ARM_TURRET_FRAME'  COORDINATE_SYSTEM_INDEX=(45,0,156,588,518,74,1864,700,42,46)  COORDINATE_SYSTEM_INDEX_NAME=('SITE','DRIVE','POSE','ARM','SHA','DRILL','RSM','HGA','BITCAR','SEAL')  ORIGIN_OFFSET_VECTOR=(1.44505,-1.20302,-1.96263)  ORIGIN_ROTATION_QUATERNION=(0.707011,-0.00397485,0.00280426,0.707186)  POSITIVE_AZIMUTH_DIRECTION='CLOCKWISE'  POSITIVE_ELEVATION_DIRECTION='UP'  REFERENCE_COORD_SYSTEM_NAME='ROVER_NAV_FRAME'  REFERENCE_COORD_SYSTEM_INDEX=(45,0,156,588,518,74,1864,700,42)  PROPERTY='TOOL_COORDINATE_SYSTEM'  SOLUTION_ID='TELEMETRY'  COORDINATE_SYSTEM_NAME='ARM_PIXL_FRAME'  COORDINATE_SYSTEM_INDEX=(45,0,156,588,518,74,1864,700,42,46)  COORDINATE_SYSTEM_INDEX_NAME=('SITE','DRIVE','POSE','ARM','SHA','DRILL','RSM','HGA','BITCAR','SEAL')  ORIGIN_OFFSET_VECTOR=(1.08737,-1.20321,-1.97322)  ORIGIN_ROTATION_QUATERNION=(0.000123835,0.000827739,-0.00479356,-0.999988)  POSITIVE_AZIMUTH_DIRECTION='CLOCKWISE'  POSITIVE_ELEVATION_DIRECTION='UP'  REFERENCE_COORD_SYSTEM_NAME='ROVER_NAV_FRAME'  REFERENCE_COORD_SYSTEM_INDEX=(45,0,156,588,518,74,1864,700,42,46)  PROPERTY='CHASSIS_ARTICULATION_STATE'  ARTICULATION_DEVICE_ID='CHASSIS'  ARTICULATION_DEVICE_NAME='MOBILITY CHASSIS'  ARTICULATION_DEVICE_ANGLE=(-4.26106e-05,-8.52212e-05,-4.26106e-05,4.26106e-05,-0.016099,0.0448473,0.0261232,-0.0116872,0.0,0.0,0.0,0.0,0.0,0.0)  ARTICULATION_DEVICE_ANGLE_NAME=('LEFT FRONT WHEEL STEER MOTOR','RIGHT FRONT WHEEL STEER MOTOR','LEFT REAR WHEEL STEER MOTOR','RIGHT REAR WHEEL STEER MOTOR','LEFT BOGIE','RIGHT BOGIE','LEFT DIFFERENTIAL','RIGHT DIFFERENTIAL','LEFT FRONT WHEEL DRIVE MOTOR','RIGHT FRONT WHEEL DRIVE MOTOR','LEFT MIDDLE WHEEL DRIVE MOTOR','RIGHT MIDDLE WHEEL DRIVE MOTOR','LEFT REAR WHEEL DRIVE MOTOR','RIGHT REAR WHEEL DRIVE MOTOR')  ARTICULATION_DEVICE_MODE='DEPLOYED'  ARTICULATION_DEV_VECTOR=(-0.00537109,-0.0239258,3.71289)  ARTICULATION_DEV_VECTOR_NAME='GRAVITY'  PROPERTY='HGA_ARTICULATION_STATE'  ARTICULATION_DEVICE_ID='HGA'  ARTICULATION_DEVICE_NAME='HIGH GAIN ANTENNA'  ARTICULATION_DEVICE_ANGLE=(1.13444,-0.784997)  ARTICULATION_DEVICE_ANGLE__UNIT=('rad','rad')  ARTICULATION_DEVICE_ANGLE_NAME=('AZIMUTH','ELEVATION')  ARTICULATION_DEVICE_MODE='DEPLOYED'  PROPERTY='RSM_ARTICULATION_STATE'  ARTICULATION_DEVICE_ID='RSM'  ARTICULATION_DEVICE_NAME='REMOTE SENSING MAST'  ARTICULATION_DEVICE_ANGLE=(2.51264,0.653373,2.51261,0.716841,2.5201,0.6557,2.5201,0.655735,2.52006,0.719259)  ARTICULATION_DEVICE_ANGLE_NAME=('AZIMUTH FINAL-RESOLVER','ELEVATION FINAL-RESOLVER','AZIMUTH INITIAL-RESOLVER','ELEVATION INITIAL-RESOLVER','AZIMUTH REQUESTED','ELEVATION REQUESTED','AZIMUTH FINAL-ENCODER','ELEVATION FINAL-ENCODER','AZIMUTH INITIAL-ENCODER','ELEVATION INITIAL-ENCODER')  ARTICULATION_DEVICE_MODE='DEPLOYED'  ARTICULATION_DEVICE_TEMP=(-18.0172,-19.2028)  ARTICULATION_DEVICE_TEMP__UNIT=('degC','degC')  ARTICULATION_DEVICE_TEMP_NAME=('NAVCAM LEFT CAMERA PLATE','NAVCAM RIGHT CAMERA PLATE')  PROPERTY='ARM_ARTICULATION_STATE'  ARTICULATION_DEVICE_ID='ARM'  ARTICULATION_DEVICE_NAME='SAMPLE ARM'  ARTICULATION_DEVICE_ANGLE=(-1.57078,-1.57082,1.57078,-0.0,3.14156,-1.57123,-1.57028,1.57113,-0.000752357,3.14182,0.0599512)  ARTICULATION_DEVICE_ANGLE__UNIT=('rad','rad','rad','rad','rad','rad','rad','rad','rad','rad','rad')  ARTICULATION_DEVICE_ANGLE_NAME=('JOINT 1 AZIMUTH-HALL SENSOR','JOINT 2 ELEVATION-HALL SENSOR','JOINT 3 ELBOW-HALL SENSOR','JOINT 4 WRIST-HALL SENSOR','JOINT 5 TURRET-HALL SENSOR','JOINT 1 AZIMUTH-RESOLVER','JOINT 2 ELEVATION-RESOLVER','JOINT 3 ELBOW-RESOLVER','JOINT 4 WRIST-RESOLVER','JOINT 5 TURRET-RESOLVER','SCS DOCKING CLOCK ANGLE')  ARTICULATION_DEVICE_TEMP=(-8.53974,-13.333,-7.87608,-18.4675,-8.28676,0.0,-31.9831)  ARTICULATION_DEVICE_TEMP__UNIT=('degC','degC','degC','degC','degC','degC','degC')  ARTICULATION_DEVICE_TEMP_NAME=('AZIMUTH JOINT','ELEVATION JOINT','ELBOW JOINT','WRIST JOINT','TURRET JOINT','DEFLECTION BODY DELTA TEMPERATURE','DEFLECTION ARM DELTA TEMPERATURE')  ARTICULATION_DEV_INSTRUMENT_ID='PIXL'  ARTICULATION_DEV_VECTOR=(0.00502331,-0.003772,0.99998)  ARTICULATION_DEV_VECTOR_NAME='GRAVITY'  CONTACT_SENSOR_STATE=('NO CONTACT','NO CONTACT','NO CONTACT','NO CONTACT','NO CONTACT','NO CONTACT','NO CONTACT','NO CONTACT')  CONTACT_SENSOR_STATE_NAME=('FACILITY CONTACT SENSOR A','FACILITY CONTACT SENSOR B','DRILL STABILIZER 1','DRILL STABILIZER 2','DOCK 1','DOCK 2','DOCK 3','DOCK 4')  ART_DEV_COMPONENT_STATE=('0','PIXL')  ART_DEV_COMPONENT_STATE_NAME=('PRELOAD_VALUE','PRELOAD_TOOL')  DEVICE_POSE_QUATERNION=(0.719858,-0.000385725,0.00311716,-0.694114)  DEVICE_POSE_NAME='arm_attitude_reference'  PROPERTY='SHA_ARTICULATION_STATE'  ARTICULATION_DEVICE_ID='SHA'  ARTICULATION_DEVICE_NAME='SAMPLE HANDLING ARM'  ARTICULATION_DEVICE_ANGLE=(0.0179931,-0.239406,2.68496,0.0,-0.239482,2.6845)  ARTICULATION_DEVICE_ANGLE__UNIT=('rad','rad','rad','rad','rad','rad')  ARTICULATION_DEVICE_ANGLE_NAME=('SHA JOINT 1 Z-HALL SENSOR','SHA JOINT 2 SHOULDER-HALL SENSOR','SHA JOINT 3 ELBOW-HALL SENSOR','SHA JOINT 1 Z-RESOLVER','SHA JOINT 2 SHOULDER-RESOLVER','SHA JOINT 3 ELBOW-RESOLVER')  PROPERTY='SCS_ARTICULATION_STATE'  ARTICULATION_DEVICE_ID='SCS'  ARTICULATION_DEVICE_NAME='SAMPLE CACHE SYSTEM'  ARTICULATION_DEVICE_ANGLE=(356.746,350.463)  ARTICULATION_DEVICE_ANGLE__UNIT=('rad','rad')  ARTICULATION_DEVICE_ANGLE_NAME=('SCS BIT CAROUSEL-HALL SENSOR','SCS BIT CAROUSEL-RESOLVER')  ARTICULATION_DEVICE_MODE='SEAL ACTIVATED'  PROPERTY='DRILL_ARTICULATION_STATE'  ARTICULATION_DEVICE_ID='DRILL'  ARTICULATION_DEVICE_NAME='DRILL'  ARTICULATION_DEVICE_ANGLE=(4907.17,-0.467789,0.0)  ARTICULATION_DEVICE_ANGLE__UNIT=('rad','rad','rad')  ARTICULATION_DEVICE_ANGLE_NAME=('SPINDLE OUTPUT POSITION-RESOLVER','CHUCK POSITION-RESOLVER','PERCUSS POSITION-RESOLVER')  ARTICULATION_DEVICE_MODE='DRILL'  PROPERTY='OBSERVATION_REQUEST_PARMS'  COMMAND_INSTRUMENT_ID='MCAMZ_BOTH'  AUTO_EXPOSURE_DATA_CUT=150  AUTO_EXPOSURE_PERCENT=10.0  AUTO_EXPOSURE_PIXEL_FRACTION=2.0  DETECTOR_ERASE_COUNT=2047  EXPOSURE_TYPE='AUTO_LAST'  EXPOSURE_DURATION_COUNT=3  FILTER_NAME='ZCAM_R0_RGB'  FILTER_NUMBER=0  INSTRUMENT_COORDINATE=(2.5201,0.6557)  INSTRUMENT_COORDINATE_NAME=('RSM_AZIMUTH','RSM_ELEVATION')  INSTRUMENT_COORD_FRAME_ID='NONE'  INSTRUMENT_COORD_FRAME_INDEX=0  MAX_AUTO_EXPOS_ITERATION_COUNT=8  INSTRUMENT_COORDINATE_TYPE='JOINTS_AZEL_ABS'  INSTRUMENT_FOCUS_MODE='MANUAL'  INSTRUMENT_FOCUS_DISTANCE=2130  INSTRUMENT_FOCUS_DISTANCE__UNIT='mm'  INSTRUMENT_MODE_ID='MODE_0X0009 20 MHz'  PROPERTY='IMAGE_REQUEST_PARMS'  DOWNLOAD_PRIORITY=78  PIXEL_DOWNSAMPLE_OPTION='NONE'  SAMPLE_BIT_MODE_ID='MCZ_LUT0'  INST_CMPRS_MODE=0  IMAGE_ID='2008928005'  INST_CMPRS_DEFERRED_FLAG='TRUE'  INST_CMPRS_NAME='MSSS_LOSSLESS'  INSTRUMENT_FOCUS_POSITION_CNT=2130  INSTRUMENT_FOCUS_STEPS=1  INSTRUMENT_FOCUS_STEP_SIZE=6  INSTRUMENT_ZOOM_POSITION_CNT=9600  COMMANDED_FOCAL_LENGTH=110.0  COMMANDED_FOCAL_LENGTH__UNIT='mm'  PROPERTY='SUBFRAME_REQUEST_PARMS'  SUBFRAME_TYPE='NONE'  FIRST_LINE=1  FIRST_LINE_SAMPLE=1  LINES=1200  LINE_SAMPLES=1648  PROPERTY='THUMBNAIL_REQUEST_PARMS'  DOWNLOAD_PRIORITY=28  PROPERTY='INSTRUMENT_STATE_PARMS'  AZIMUTH_FOV=6.36042  AZIMUTH_FOV__UNIT='deg'  ELEVATION_FOV=4.63709  ELEVATION_FOV__UNIT='deg'  CFA_TYPE='BAYER_RGGB'  DETECTOR_FIRST_LINE=1  DETECTOR_FIRST_LINE_SAMPLE=1  DETECTOR_LINES=1200  DETECTOR_LINE_SAMPLES=1648  DOWNSAMPLE_METHOD='NONE'  EXPOSURE_COUNT=269  EXPOSURE_DURATION=26.9  EXPOSURE_DURATION__UNIT='ms'  FILTER_NAME='ZCAM_R0_RGB'  FILTER_NUMBER=0  FOCUS_POSITION_COUNT=2130  INSTRUMENT_TEMPERATURE=(0.0,-16.513,-13.2902,-17.6347)  INSTRUMENT_TEMPERATURE_NAME=('DEA','HEAD_FPA','HEAD_HTR_1','HEAD_HTR_2')  INSTRUMENT_TEMPERATURE_STATUS=(-42,0,0,0)  PIXEL_AVERAGING_HEIGHT=1  PIXEL_AVERAGING_WIDTH=1  SAMPLE_BIT_MODE_ID='MCZ_LUT0'  DEVICE_COMPONENT_STATE=(1,0)  DEVICE_COMPONENT_STATE_NAME=('DEA POWER','HEATER POWER')  FILTER_POSITION_COUNT=0  ZOOM_POSITION_COUNT=9600  FOCAL_LENGTH=110.0  FOCAL_LENGTH__UNIT='mm'  DC_OFFSET=110  CENTER_FILTER_WAVELENGTH=(631,544,480)  CENTER_FILTER_WAVELENGTH__UNIT=('nm','nm','nm')  SAMPLE_BIT_METHOD='HARDWARE_INVERTED'  BAYER_METHOD='MALVAR'  CFA_VENUE='GROUND'  PROPERTY='COMPRESSION_PARMS'  INST_CMPRS_MODE=0  INST_CMPRS_NAME='MSSS_LOSSLESS'  INST_CMPRS_QUALITY=0  INST_CMPRS_RATE=7.24278  INST_CMPRS_RATIO=1.10455  INST_CMPRS_DEFERRED_FLAG='FALSE'  PROPERTY='ROVER_DERIVED_GEOMETRY_PARMS'  INSTRUMENT_AZIMUTH__UNIT='deg'  INSTRUMENT_ELEVATION__UNIT='deg'  REFERENCE_COORD_SYSTEM_INDEX=(45,0,156,588,518,74,1864,700,42,46)  REFERENCE_COORD_SYSTEM_NAME='ROVER_NAV_FRAME'  INSTRUMENT_AZIMUTH=-39.4062  INSTRUMENT_ELEVATION=-53.7573  PROPERTY='SITE_DERIVED_GEOMETRY_PARMS'  INSTRUMENT_AZIMUTH__UNIT='deg'  INSTRUMENT_ELEVATION__UNIT='deg'  REFERENCE_COORD_SYSTEM_INDEX=45  REFERENCE_COORD_SYSTEM_NAME='SITE_FRAME'  SOLAR_AZIMUTH=284.188  SOLAR_AZIMUTH__UNIT='deg'  SOLAR_ELEVATION=28.2546  SOLAR_ELEVATION__UNIT='deg'  INSTRUMENT_AZIMUTH=-126.924  INSTRUMENT_ELEVATION=-53.8701  PROPERTY='IMAGE_DATA'  FIRST_LINE=1  FIRST_LINE_SAMPLE=1  INVALID_CONSTANT=0.0  MISSING_CONSTANT=0.0  SAMPLE_BIT_MASK='2#0000111111111111#'  PROPERTY='MINI_HEADER'  IMAGE_ID=2816  MAGIC_NUMBERS=('FF00F0CA','1010CC28')  SPACECRAFT_CLOCK_START_COUNT='748803446.343'  DETECTOR_ERASE_COUNT=2047  INSTRUMENT_MODE_ID='MODE_0X0009 20 MHz'  FILTER_NUMBER=0  EXPOSURE_DURATION_COUNT=269  FIRST_LINE_SAMPLE=1  FIRST_LINE=1  LINE_SAMPLES=1648  LINES=1200  INSTRUMENT_FOCUS_MODE='MANUAL'  INSTRUMENT_FOCUS_POSITION=2130  INSTRUMENT_FOCUS_STEP_SIZE=6  INSTRUMENT_FOCUS_STEPS=1  AUTO_FOCUS_ZSTACK_FLAG=0  AUTO_EXPOSURE_DATA_CUT=150  AUTO_EXPOSURE_PIXEL_FRACTION=2  AUTO_EXPOSURE_PERCENT=10  MAX_AUTO_EXPOS_ITERATION_COUNT=8  INST_CMPRS_MODE=0  INST_CMPRS_NAME='MSSS_LOSSLESS'  INST_CMPRS_QUALITY=0  SAMPLE_BIT_MODE_ID='MCZ_LUT0'  INSTRUMENT_STATE=('FALSE','FALSE','FALSE','FALSE','FALSE','TRUE','TRUE','TRUE')  INSTRUMENT_STATE_NAME=('SPARE','UV_LED','VIS1_LED','VIS2_LED','SPARE','FILTER_HALL_STATE','COVER_HALL_STATE','FOCUS_HALL_STATE')  INSTRUMENT_SERIAL_NUMBER=102801  ARTICULATION_DEV_POSITION=(2130,0,9600)  ARTICULATION_DEV_POSITION_NAME=('FOCUS','FILTER','ZOOM')  DC_OFFSET=110  INITIAL_SIZE=1977664  INSTRUMENT_MODE=(0,0,0,0,0,0,1,0,0,1)  INSTRUMENT_MODE_NAME=('SPARE','CCD_STATE','LED1_CONTROL','LED2_CONTROL','LED3_CONTROL','VIDEO_EXPOSURE','CLKDIV2','LONG_INTEGRATION_MODE','TEST_MODE','CLKDIV1')  PROPERTY='GEOMETRIC_CAMERA_MODEL'  CALIBRATION_SOURCE_ID='1'  MODEL_TYPE='CAHVOR'  MODEL_COMPONENT_ID=('C','A','H','V','O','R')  MODEL_COMPONENT_NAME=('CENTER','AXIS','HORIZONTAL','VERTICAL','OPTICAL','RADIAL')  MODEL_COMPONENT_UNIT=('METER','N/A','PIXEL','PIXEL','N/A','N/A')  MODEL_COMPONENT_1=(0.932278,0.61291,-1.93734)  MODEL_COMPONENT_2=(0.455378,-0.369038,0.810221)  MODEL_COMPONENT_3=(9391.68,11342.2,979.636)  MODEL_COMPONENT_4=(-9238.39,6911.61,9192.04)  MODEL_COMPONENT_5=(0.459503,-0.378537,0.803482)  MODEL_COMPONENT_6=(0.000474231,0.78535,-0.0183809)  MODEL_TRANSFORM_VECTOR=(0.805021,0.5594,-1.91903)  MODEL_TRANSFORM_QUATERNION=(0.846242,-0.144295,-0.426519,-0.284844)  REFERENCE_COORD_SYSTEM_NAME='ROVER_NAV_FRAME'  REFERENCE_COORD_SYSTEM_INDEX=(45,0,156)  INTERPOLATION_METHOD='ZOOM'  INTERPOLATION_VALUE=9600.0  PROPERTY='DERIVED_IMAGE_PARMS'  INVERSE_LUT_FILE_NAME='ilut/M20_MCZ_LUT0.txt'  DERIVED_IMAGE_TYPE='IMAGE'  INPUT_PRODUCT_ID='ZRF_0922_0748803435_956FDR_N0450000ZCAM08928_1100LMJ02'  RADIANCE_OFFSET=0.0  RADIANCE_OFFSET__UNIT='WATT*M**-2*SR**-1*NM**-1'  RADIANCE_SCALING_FACTOR=1e-05  RADIANCE_SCALING_FACTOR__UNIT='WATT*M**-2*SR**-1*NM**-1'  RADIOMETRIC_CORRECTION_TYPE='MIPLRAD'  RADIOMETRIC_TYPE='Spectral Radiance'  RESPONSIVITY_R=5.85463e-07  RESPONSIVITY_G=5.56483e-07  RESPONSIVITY_B=5.81611e-07  FLAT_FIELD_FILE_NAME=('TAMBR0_8652_v1','R0_8652_cont_v1','R0_9600_cont_v1','R7_bias_-20','R0_bias_dyn')  FLAT_FIELD_FILE_DESC=('Mastcam-Z radiometric pre-flight flat field for R0 at zoom 8652.  Prepared by A. Hayes, converted to VICAR by R. Deen','Mastcam-Z continuous pre-flight flat field for R0 at zoom 8652.  Prepared by A. Hayes, converted to VICAR by R. Deen','Mastcam-Z continuous pre-flight flat field for R0 at zoom 9600.  Prepared by A. Hayes, converted to VICAR by R. Deen','Mastcam-Z static bias file for R at temperature -20.  Prepared by A. Hayes, converted to VICAR by R. Deen','Mastcam-Z dynamic bias file for R0.  Prepared by A. Hayes, converted to VICAR by R. Deen')  PROPERTY='VICAR_PROCESSING'  COREG_ELIGIBLE='true'  TASK='TASK'  USER='jpluser'  DAT_TIM='Mon Sep 25 04:10:13 2023'  TASK='MARSRELA'  USER='jpluser'  DAT_TIM='Mon Sep 25 04:10:13 2023'  INP='inpZR0_0922_0748803435_956ECM_N0450000ZCAM08928_1100LMJ00.VIC'  OUT='ZR0_0922_0748803435_956ECM_N0450000ZCAM08928_1100LMJ00.VIC'  CM='CM'  AZEL='AZEL'  TASK='MARSINVE'  USER='jpluser'  DAT_TIM='Mon Sep 25 04:14:01 2023'  INP='ZR0_0922_0748803435_956ECM_N0450000ZCAM08928_1100LMJ02.VIC'  OUT='ZR0_0922_0748803435_956EDR_N0450000ZCAM08928_1100LMJ02.VIC'  POINT_METHOD='cm=label'  TASK='MARSDEBA'  USER='jpluser'  DAT_TIM='Mon Sep 25 04:14:10 2023'  INP='ZR0_0922_0748803435_956EDR_N0450000ZCAM08928_1100LMJ02.VIC'  OUT='ZR0_0922_0748803435_956EBY_N0450000ZCAM08928_1100LMJ02.VIC'  INTERP='MALVAR'  MAX_DN=4095.0  POINT_METHOD='cm=label'  TASK='MARSRAD'  USER='jpluser'  DAT_TIM='Mon Sep 25 04:18:45 2023'  INP='ZRF_0922_0748803435_956FDR_N0450000ZCAM08928_1100LMJ02.VIC'  OUT='ZRF_0922_0748803435_956RAS_N0450000ZCAM08928_1100LMJ02.VIC'  DNSCALE=100.0  POINT_METHOD='cm=label'  BITS=12  |<nil>
}

func Example_parseVICARLabel() {
	imgFileBytes, err := os.ReadFile("./test-data/ZRF_0922_0748803435_956RAS_N0450000ZCAM08928_1100LMJ02.IMG")
	if err != nil {
		return
	}

	lbl, err := readVICARLabel(imgFileBytes, 32960)
	sz, w, h, b, ch, err := parseVICARLabel(lbl)
	fmt.Printf("%v|%v|%v|%v|%v|%v", sz, w, h, b, ch, err)

	// Output:
	// 19776|1648|1200|2|3|<nil>
}

func Example_readIMGFile() {
	imgFileBytes, err := os.ReadFile("./test-data/ZRF_0922_0748803435_956RAS_N0450000ZCAM08928_1100LMJ02.IMG")
	if err != nil {
		return
	}

	w, h, d, err := ReadIMGFile(imgFileBytes)
	fmt.Printf("%v|%v|%v|%v,%v,%v,%v|%v,%v,%v,%v|%v", w, h, len(d), d[0], d[1], d[2], d[3], d[84000], d[84001], d[84002], d[84003], err)

	pngFile, err := os.Create("./test-output.png")
	if err != nil {
		return
	}

	defer pngFile.Close()

	i := imageedit.MakeImageFromRGBA(w, h, d)

	err = png.Encode(pngFile, i)
	fmt.Printf("%v", err)

	// Image size should be:
	// 11,918,336 - 32,960 - 19,776 = 11865600
	// But converted to 8bit RGB we get:
	// 1200 * 1648 * 4 = 7910400

	// Output:
	// 1648|1200|7910400|0,0,0,255|60,28,0,255|<nil><nil>
}
